const { By, Key, Builder, until } = require("selenium-webdriver");
const { Options, ServiceBuilder } = require('selenium-webdriver/chrome');
const { Select } = require('selenium-webdriver');

require("chromedriver");

async function test_case() {
  try {
    // Create a new driver instance for Chrome
    const chromeOptions = new Options();
    chromeOptions.addArguments("--start-maximized"); // Maximize the browser window
    const serviceBuilder = new ServiceBuilder(process.env.CHROMEDRIVER_PATH); // Use the environment variable

    let driver = await new Builder()
      .forBrowser("chrome")
      .setChromeOptions(chromeOptions)
      .setChromeService(serviceBuilder)
      .build();

    // Navigate to the login page
    await driver.get("https://client.manduu.work/login");

    // Add an explicit wait for the page to load completely
    await driver.wait(until.urlIs('https://client.manduu.work/login'));

    // Find the username and password fields
    let usernameField = await driver.findElement(By.name("username"));
    let passwordField = await driver.findElement(By.name("password"));

    // Enter the username and password
    await usernameField.sendKeys("kenn@kennpalm.com");
    await passwordField.sendKeys("Test1234");

    // Submit the form (assuming it's a form submission)
    await passwordField.sendKeys(Key.RETURN);

    // Use explicit wait to wait for the pop-up dialog
    let popUp = await driver.wait(until.elementLocated(By.className('swal2-popup')), 10000);

    // Find the "OK" button within the pop-up and click it
    let okButton = await popUp.findElement(By.className('swal2-confirm'));
    await okButton.click();

    // Click on a specific day (e.g., 2023-09-28)
    let dayElement = await driver.wait(
      until.elementLocated(By.xpath("//td[@data-date='2023-09-28']//a[@class='fc-daygrid-day-number']")),
      10000
    );
    await dayElement.click();

    // Explicit wait to allow time for the dropdown to appear
    await driver.sleep(2000);

    // Locate the dropdown element
    let dropdown = await driver.findElement(By.css('select.form-control'));

    // Use JavaScript to click on the dropdown and open it
    await driver.executeScript("arguments[0].click();", dropdown);

    // Use an explicit wait to wait for the options to become visible
    await driver.wait(until.elementLocated(By.css('select.form-control option')), 10000);

    // Select a time slot from the dropdown by text
    await driver.findElement(By.xpath("//option[text()='8:00 AM (2)']")).click(); // Replace with the desired time slot

    // Close the driver
    // await driver.quit();
  } catch (error) {
    // Handle any errors or exceptions
    console.error(error);
  }
}

// Call the test_case function
test_case();
